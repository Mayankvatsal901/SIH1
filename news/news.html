<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ocean & Seas News Hub</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide-react@0.292.0/dist/lucide-react.js"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s, color 0.3s;
        }

        /* Scrollbar styles */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .dark ::-webkit-scrollbar-track {
            background: #2d3748;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #555;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #333;
        }
        
        /* Spinner Animation */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s ease infinite;
        }
        .dark .spinner {
            border-left-color: #38bdf8;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Card hover effect */
        .news-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .news-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .dark .news-card:hover {
             box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
        }
        
        /* Modal Styles */
        .modal-overlay {
            transition: opacity 0.3s ease;
        }
        .modal-content {
            transition: transform 0.3s ease, opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">

    <!-- Header -->
    <header class="bg-white/70 dark:bg-gray-800/70 backdrop-blur-md shadow-sm sticky top-0 z-10">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-500"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z"></path><path d="M15.5 16.5a6.49 6.49 0 0 0-7.01-4.22c-2.43.9-4.2 3.2-4.49 5.88"></path><path d="M16.5 7.5a6.49 6.49 0 0 1-7.01 4.22c-2.43-.9-4.2-3.2-4.49-5.88"></path></svg>
                <h1 class="text-xl font-bold text-gray-900 dark:text-white">Ocean News Hub</h1>
            </div>
            <button id="theme-toggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                <svg id="theme-icon-light" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                <svg id="theme-icon-dark" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
        </nav>
    </header>

    <!-- Gemini Modal -->
    <div id="gemini-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4 hidden opacity-0">
        <div class="modal-content bg-white dark:bg-gray-800 rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col transform scale-95 opacity-0">
            <div class="flex justify-between items-center p-4 border-b dark:border-gray-700">
                <h3 id="modal-title" class="text-xl font-bold">✨ AI Assistant</h3>
                <button id="close-modal-btn" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-600">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="modal-body" class="p-6 overflow-y-auto">
                <div class="flex items-center justify-center h-48">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8">
        
        <!-- Gemini Summary Button -->
        <div class="mb-8 text-center">
            <button id="summarize-btn" class="bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105 transition-all duration-300 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                ✨ Get Today's News Summary
            </button> -->
        </div>

        <!-- Section: Latest Ocean & Seas News -->
        <section id="ocean-news-section">
            <h2 class="text-3xl font-bold mb-6 border-l-4 border-blue-500 pl-4">Latest Ocean & Seas News</h2>
            <div id="ocean-news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Loading Skeletons -->
            </div>
            <div id="ocean-news-error" class="hidden text-center text-red-500 bg-red-100 dark:bg-red-900/50 p-4 rounded-lg"></div>
        </section>

        <!-- Section: Argo Floats News -->
        <section id="argo-news-section" class="mt-16">
            <h2 class="text-3xl font-bold mb-6 border-l-4 border-teal-500 pl-4">Argo Floats News</h2>
            <div id="argo-news-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                 <!-- Loading Skeletons -->
            </div>
             <div id="argo-news-error" class="hidden text-center text-red-500 bg-red-100 dark:bg-red-900/50 p-4 rounded-lg"></div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800 mt-16 border-t border-gray-200 dark:border-gray-700">
        <div class="container mx-auto px-6 py-4 text-center text-gray-600 dark:text-gray-400">
            <p>&copy; 2024 Ocean News Hub. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const themeToggle = document.getElementById('theme-toggle');
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');
            const htmlEl = document.documentElement;
            const summarizeBtn = document.getElementById('summarize-btn');
            const modal = document.getElementById('gemini-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            const closeModalBtn = document.getElementById('close-modal-btn');
            
            let allArticles = [];

            // --- IMPORTANT: API Key Configuration ---
            // To fetch real-time news, you need a GNews API key.
            // 1. Go to gnews.io and sign up for a free API key.
            // 2. Replace "YOUR_GNEWS_API_KEY" below with the key you receive.
            const GNEWS_API_KEY = "a2f80714339587b2ba9a0a0a23fa628c";


            // --- Theme Switcher Logic ---
            const currentTheme = localStorage.getItem('theme') || 'light';
            htmlEl.classList.add(currentTheme);
            updateIcon(currentTheme);
            
            function updateIcon(theme) {
                if (theme === 'dark') {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                } else {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                }
            }
            
            themeToggle.addEventListener('click', () => {
                const newTheme = htmlEl.classList.contains('dark') ? 'light' : 'dark';
                htmlEl.classList.remove('light', 'dark');
                htmlEl.classList.add(newTheme);
                localStorage.setItem('theme', newTheme);
                updateIcon(newTheme);
            });
            
            // --- Modal Logic ---
            function showModal(title, content = '') {
                modalTitle.textContent = title;
                if (content) {
                    modalBody.innerHTML = content;
                } else {
                    modalBody.innerHTML = `<div class="flex items-center justify-center h-48"><div class="spinner"></div></div>`;
                }
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
                }, 10);
            }

            function closeModal() {
                modal.classList.add('opacity-0');
                modal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
                setTimeout(() => modal.classList.add('hidden'), 300);
            }
            
            closeModalBtn.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                if(e.target === modal) closeModal();
            });

            // --- Gemini API Call Logic with Improved Error Handling ---
            const callGeminiAPI = async (prompt, retries = 3, delay = 1000) => {
                const apiKey = ""; // API key will be injected by the environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                };

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.json().catch(() => ({ error: { message: 'Could not parse error response body.' }}));
                        const errorMessage = errorBody.error?.message || 'Unknown API error';
                        throw new Error(`HTTP error! status: ${response.status}, message: ${errorMessage}`);
                    }

                    const result = await response.json();
                    const candidate = result.candidates?.[0];

                    if (candidate && candidate.content?.parts?.[0]?.text) {
                        return candidate.content.parts[0].text;
                    } else {
                         if (candidate && candidate.finishReason !== 'STOP') {
                             throw new Error(`API call finished with reason: ${candidate.finishReason}. This might be due to safety settings or other content restrictions.`);
                        }
                        throw new Error("Invalid response structure from API. No content was returned.");
                    }
                } catch (error) {
                    console.error(`Gemini API call attempt failed: ${error.message}`);
                    if (retries > 0) {
                        await new Promise(res => setTimeout(res, delay));
                        return callGeminiAPI(prompt, retries - 1, delay * 2);
                    } else {
                        console.error('All Gemini API call retries failed.');
                        return "Sorry, I couldn't connect to the AI assistant right now. Please try again later.";
                    }
                }
            };
            
            // --- Mock News Data (Fallback) ---
            const getMockOceanNews = () => {
                return new Promise(resolve => {
                    setTimeout(() => {
                        resolve({
                            articles: [
                                { title: "Scientists Discover New Deep-Sea Coral Reef Ecosystem", description: "A sprawling deep-sea coral reef, previously unknown to science, has been discovered off the coast, teeming with unique marine life. This finding highlights how much of our oceans remains unexplored.", url: "#", image: "https://placehold.co/600x400/3B82F6/FFFFFF?text=Deep+Sea+Reef", source: { name: "Oceanographic Journal" }},
                                { title: "Alarming Rate of Ocean Warming Recorded in 2024", description: "New data reveals that ocean temperatures have risen at an unprecedented rate this year, posing a significant threat to marine ecosystems and global weather patterns.", url: "#", image: "https://placehold.co/600x400/EF4444/FFFFFF?text=Ocean+Warming", source: { name: "Global Climate Report" }},
                                { title: "Success in Marine Protected Area Leads to Whale Population Rebound", description: "A decade after its establishment, a major Marine Protected Area (MPA) in the Pacific is showing remarkable success, with humpback whale populations making a significant comeback.", url: "#", image: "https://placehold.co/600x400/10B981/FFFFFF?text=Whale+Rebound", source: { name: "Marine Biology Today" }},
                            ]
                        });
                    }, 500);
                });
            };

            const getMockArgoNews = () => {
                return new Promise(resolve => {
                    setTimeout(() => {
                        resolve({
                            articles: [
                                { title: "Global Argo Network Surpasses 4,000 Active Floats", description: "The international Argo program has reached a new milestone, with over 4,000 robotic floats actively monitoring temperature, salinity, and currents in the world's oceans.", url: "#", image: "https://placehold.co/600x400/14B8A6/FFFFFF?text=4000+Floats", source: { name: "Argo Program HQ" }},
                                { title: "Argo Floats Equipped with New Biogeochemical Sensors", description: "A new generation of Argo floats is being deployed with advanced sensors to measure parameters like oxygen, nitrate, and pH, providing critical data on ocean health.", url: "#", image: "https://placehold.co/600x400/8B5CF6/FFFFFF?text=New+Sensors", source: { name: "Ocean Tech Monthly" }},
                            ]
                        });
                    }, 500);
                });
            };

            // --- News Fetching Logic ---
            const getRealtimeNews = async (query, maxItems = 6) => {
                const url = `https://gnews.io/api/v4/search?q=${encodeURIComponent(query)}&lang=en&max=${maxItems}&token=${GNEWS_API_KEY}`;
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`GNews API Error: ${errorData.errors[0]}`);
                }
                return await response.json();
            };
            
            const fetchOceanNews = () => {
                if (!GNEWS_API_KEY || GNEWS_API_KEY === "YOUR_GNEWS_API_KEY") {
                    console.warn("GNews API Key missing. Falling back to mock data for Ocean News.");
                    return getMockOceanNews();
                }
                return getRealtimeNews('"ocean" OR "sea" OR "marine" OR "maritime"', 6);
            };

            const fetchArgoNews = () => {
                if (!GNEWS_API_KEY || GNEWS_API_KEY === "YOUR_GNEWS_API_KEY") {
                    console.warn("GNews API Key missing. Falling back to mock data for Argo Floats News.");
                    return getMockArgoNews();
                }
                return getRealtimeNews('"argo floats" OR "oceanographic floats"', 3);
            };

            const createNewsCard = (article) => {
                const escapedTitle = article.title.replace(/"/g, '&quot;');
                const escapedDescription = article.description.replace(/"/g, '&quot;');
                
                return `
                    <div class="news-card bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-md flex flex-col">
                        <a href="${article.url}" target="_blank" rel="noopener noreferrer">
                            <img src="${article.image}" alt="${article.title}" class="w-full h-48 object-cover" onerror="this.onerror=null;this.src='https://placehold.co/600x400/94A3B8/FFFFFF?text=Image+Error';">
                        </a>
                        <div class="p-6 flex flex-col flex-grow">
                            <span class="text-sm font-semibold text-blue-500 dark:text-blue-400">${article.source.name}</span>
                            <h3 class="mt-2 mb-2 text-xl font-bold text-gray-900 dark:text-white">${article.title}</h3>
                            <p class="text-gray-600 dark:text-gray-400 text-base flex-grow">${article.description}</p>
                            <div class="mt-4 pt-4 border-t dark:border-gray-700 flex flex-wrap gap-2 items-center justify-between">
                               <a href="${article.url}" target="_blank" rel="noopener noreferrer" class="text-blue-600 dark:text-blue-400 hover:underline font-semibold">Read More &rarr;</a>
                               <button class="explain-btn bg-purple-100 dark:bg-purple-900/50 text-purple-700 dark:text-purple-300 text-sm font-semibold px-3 py-1 rounded-full hover:bg-purple-200 dark:hover:bg-purple-800/70"
                                    data-title="${escapedTitle}" data-description="${escapedDescription}">
                                    ✨ Explain Simply
                               </button>
                            </div>
                        </div>
                    </div>
                `;
            };
            
            const createSkeletonCard = () => {
                return `<div class="bg-white dark:bg-gray-800 rounded-lg overflow-hidden shadow-md animate-pulse"><div class="w-full h-48 bg-gray-300 dark:bg-gray-700"></div><div class="p-6"><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-1/3 mb-4"></div><div class="h-6 bg-gray-300 dark:bg-gray-700 rounded w-full mb-3"></div><div class="h-6 bg-gray-300 dark:bg-gray-700 rounded w-5/6 mb-4"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-full mb-2"></div><div class="h-4 bg-gray-300 dark:bg-gray-700 rounded w-3/4 mb-4"></div><div class="h-5 bg-gray-300 dark:bg-gray-700 rounded w-1/4"></div></div></div>`;
            };

            const renderSkeletons = (container, count) => {
                let skeletons = '';
                for(let i = 0; i < count; i++) {
                    skeletons += createSkeletonCard();
                }
                container.innerHTML = skeletons;
            }

            const fetchAndRenderNews = async (fetchFunction, containerId, errorContainerId, skeletonCount) => {
                const container = document.getElementById(containerId);
                const errorContainer = document.getElementById(errorContainerId);
                
                renderSkeletons(container, skeletonCount);
                errorContainer.classList.add('hidden');

                try {
                    const data = await fetchFunction();
                    if (data && data.articles && data.articles.length > 0) {
                        allArticles.push(...data.articles);
                        container.innerHTML = data.articles.map(createNewsCard).join('');
                    } else {
                         container.innerHTML = '';
                         errorContainer.textContent = 'No news found on this topic.';
                         errorContainer.classList.remove('hidden');
                    }
                } catch (error) {
                    console.error('Failed to fetch news:', error);
                    container.innerHTML = '';
                    let errorMessage = `Could not load news. Please try again later.`;
                    if(GNEWS_API_KEY === "YOUR_GNEWS_API_KEY") {
                        errorMessage = 'GNews API Key is missing. Using mock data. Please add your key to fetch live news.';
                    } else if (error.message.includes("GNews")) {
                        errorMessage = `Could not load news from GNews: ${error.message}. Please check your API key and network.`
                    }
                    errorContainer.textContent = errorMessage;
                    errorContainer.classList.remove('hidden');
                }
            };
            
            // --- Gemini Feature Event Listeners ---
            summarizeBtn.addEventListener('click', async () => {
                if (allArticles.length === 0) return;
                
                showModal('✨ Summarizing Today\'s News...');
                
                const titles = allArticles.map(a => a.title).join('\n');
                const prompt = `You are a marine biologist and news analyst. Summarize the following list of news headlines about oceans into a single, engaging paragraph. Highlight the most important or interesting developments.\n\nHeadlines:\n${titles}`;
                
                const summary = await callGeminiAPI(prompt);
                showModal('✨ Today\'s News Summary', `<p class="text-lg leading-relaxed">${summary.replace(/\n/g, '<br>')}</p>`);
            });
            
            document.querySelector('main').addEventListener('click', async (e) => {
                if (e.target.classList.contains('explain-btn')) {
                    const button = e.target;
                    const title = button.dataset.title;
                    const description = button.dataset.description;
                    
                    showModal(`✨ Explaining "${title}"`);
                    
                    const prompt = `Explain the following news item as if you were talking to a curious 10-year-old. Use simple terms and maybe an analogy.\n\nTitle: ${title}\nDescription: ${description}`;
                    
                    const explanation = await callGeminiAPI(prompt);
                    showModal(`✨ Explaining "${title}"`, `<p class="text-lg leading-relaxed">${explanation.replace(/\n/g, '<br>')}</p>`);
                }
            });

            // --- Initial Load ---
            Promise.all([
                fetchAndRenderNews(fetchOceanNews, 'ocean-news-container', 'ocean-news-error', 6),
                fetchAndRenderNews(fetchArgoNews, 'argo-news-container', 'argo-news-error', 3)
            ]).then(() => {
                if (GNEWS_API_KEY === "YOUR_GNEWS_API_KEY") {
                   const oceanError = document.getElementById('ocean-news-error');
                   oceanError.textContent = 'Displaying sample news. Add your GNews API key to the code to fetch live data.';
                   oceanError.classList.remove('hidden', 'text-red-500', 'bg-red-100', 'dark:bg-red-900/50');
                   oceanError.classList.add('text-amber-700', 'bg-amber-100', 'dark:bg-amber-900/50');
                }
                summarizeBtn.disabled = allArticles.length === 0;
            });
        });
    </script>
</body>
</html>

